<%= turbo_stream_from "dashboard_live_activities" %>
<%= turbo_stream_from "dashboard_action_items" %>
<%= turbo_stream_from "dashboard_overview" %>

<div id="dashboard_live_activities" class="overflow-x-auto pb-2 whitespace-nowrap mb-6 px-8">
  <% @live_activities.each do |activity| %>
    <%= render "dashboard/live_activity", live_activity: activity %>
  <% end %>
</div>

<div data-controller="item-count">
  <h2 class="text-xl font-semibold mb-4 px-8"><%= link_to "Action Items", action_items_path, class: "hover:underline" %><span data-item-count-target="count"><%= " (#{@action_items.size})" if @action_items.any? %></span></h2>
  <div id="dashboard_action_items" data-item-count-target="items" data-controller="sorted-list" class="flex items-stretch gap-3 overflow-x-auto pb-2 mb-8 px-8" <%= "hidden" if @action_items.empty? %>>
    <% @action_items.each do |action_item| %>
      <%= render "dashboard/action_item", action_item: action_item %>
    <% end %>
  </div>
  <p data-item-count-target="empty" class="text-sm text-muted mb-8 px-8" <%= "hidden" unless @action_items.empty? %>>You're all clear! No action items right now.</p>
</div>

<div class="mb-8 px-8">
  <h2 class="text-xl font-semibold mb-4">Overview</h2>
  <%= render "dashboard/overview", overview: @overview %>
</div>

<div data-controller="deck reply-modal" data-action="keydown@window->reply-modal#closeOnKey" class="px-8">
  <div class="flex items-center justify-between mb-6">
    <h1 class="text-xl font-semibold">Deck</h1>
    <button type="button" data-action="deck#openAddModal"
            class="text-sm px-3 py-1.5 bg-primary text-primary-foreground rounded-md hover:opacity-90">
      + Add Column
    </button>
  </div>

  <div id="deck_columns" data-deck-target="columns" class="flex gap-4 overflow-x-auto pb-4 snap-x snap-mandatory -mx-8 px-8 scroll-pl-8">
    <% @feeds.each do |feed| %>
      <%= render "dashboard/feed_column", feed: feed,
            feed_items: @feed_items[feed.id],
            feed_has_more: @feed_has_more[feed.id] %>
    <% end %>

    <div class="w-[400px] shrink-0 snap-start">
      <div class="border-2 border-dashed border-border rounded-lg flex items-center justify-center h-48 text-muted cursor-pointer hover:border-primary hover:text-foreground transition-colors"
           data-action="click->deck#openAddModal">
        <span class="text-sm">+ Add Column</span>
      </div>
    </div>
  </div>

  <%= render "dashboard/feed_column_modal", available_channels: @available_channels %>
  <%= render "dashboard/reply_modal" %>
</div>
